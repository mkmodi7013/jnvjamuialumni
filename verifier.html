<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Verifier Alumni</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Arial;
  background:#f2f4f7;
  padding:20px;
}
h2{text-align:center}

.filter-box{
  max-width:1400px;
  margin:10px auto 15px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.filter-box input,
.filter-box select{
  padding:8px;
  font-size:14px;
}

table{
  width:100%;
  max-width:1400px;
  margin:auto;
  border-collapse:collapse;
  background:#fff;
  font-size:13px;
}
th,td{
  padding:8px;
  border:1px solid #ddd;
  text-align:left;
}
th{
  background:#0d6efd;
  color:#fff;
  position:sticky;
  top:0;
}
tr:nth-child(even){
  background:#f9f9f9;
}
.badge{
  background:#198754;
  color:#fff;
  padding:3px 6px;
  border-radius:4px;
  font-size:11px;
}
a{color:#0d6efd;text-decoration:none}
</style>
</head>

<body>

<h2>All Verifier Alumni</h2>

<!-- ðŸ” FILTERS -->
<div class="filter-box">
  <input type="text" id="searchInput" placeholder="Search name / email / mobile">
  
  <select id="yearFilter">
    <option value="">All Entry Years</option>
  </select>

  <select id="genderFilter">
    <option value="">All Gender</option>
    <option value="Male">Male</option>
    <option value="Female">Female</option>
  </select>
</div>

<table>
<thead>
<tr>
  <th>UID</th>
  <th>Name</th>
  <th>Email</th>
  <th>Mobile</th>
  <th>Gender</th>
  <th>Entry Class</th>
  <th>Entry Year</th>
  <th>Role</th>
</tr>
</thead>

<tbody id="tableBody">
<tr><td colspan="8" style="text-align:center">Loading...</td></tr>
</tbody>
</table>

<script type="module">
import { ref, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
import { db } from "./firebase.js";

const tableBody = document.getElementById("tableBody");
const searchInput = document.getElementById("searchInput");
const yearFilter = document.getElementById("yearFilter");
const genderFilter = document.getElementById("genderFilter");

let allVerifiers = [];

// ðŸ”¥ FETCH DATA
get(ref(db, "alumni"))
.then(snapshot => {

  if (!snapshot.exists()) {
    tableBody.innerHTML =
      `<tr><td colspan="8" style="text-align:center">No data found</td></tr>`;
    return;
  }

  const list = [];

  snapshot.forEach(child => {
    const uid = child.key;
    const u = child.val();

    if (u && u.verifier === "Verifier") {
      list.push({
        firebaseUid: uid,
        name: u.name || "-",
        email: u.email || "-",
        mobile: u.mobile || "-",
        gender: u.gender || "-",
        entryclass: u.entryclass || "-",
        entryyear: u.entryyear || "-"
      });
    }
  });

  // sort by entry year
  list.sort((a,b)=>(parseInt(a.entryyear)||9999)-(parseInt(b.entryyear)||9999));

  allVerifiers = list;
  populateYearFilter(list);
  renderTable(list);
})
.catch(err=>{
  console.error(err);
  tableBody.innerHTML =
    `<tr><td colspan="8" style="text-align:center">Error loading data</td></tr>`;
});

// ðŸ§¾ RENDER TABLE
function renderTable(data){
  if(data.length===0){
    tableBody.innerHTML =
      `<tr><td colspan="8" style="text-align:center">No result</td></tr>`;
    return;
  }

  let rows = "";
  data.forEach(u=>{
    rows += `
    <tr>
      <td>${u.firebaseUid}</td>
      <td>${u.name}</td>
      <td>
        ${u.email !== "-" 
          ? `<a href="verifierLogin.html?email=${encodeURIComponent(u.email)}">${u.email}</a>`
          : "-"
        }
      </td>
      <td><a href="tel:${u.mobile}">${u.mobile}</a></td>
      <td>${u.gender}</td>
      <td>${u.entryclass}</td>
      <td>${u.entryyear}</td>
      <td><span class="badge">Sub Admin</span></td>
    </tr>`;
  });

  tableBody.innerHTML = rows;
}

// ðŸ“… YEAR DROPDOWN
function populateYearFilter(data){
  const years = [...new Set(data.map(u=>u.entryyear).filter(y=>y!=="-"))];
  years.forEach(y=>{
    const opt = document.createElement("option");
    opt.value = y;
    opt.textContent = y;
    yearFilter.appendChild(opt);
  });
}

// ðŸ” FILTER LOGIC
function applyFilter(){
  const search = searchInput.value.toLowerCase();
  const year = yearFilter.value;
  const gender = genderFilter.value;

  const filtered = allVerifiers.filter(u=>{
    const matchSearch =
      u.name.toLowerCase().includes(search) ||
      u.email.toLowerCase().includes(search) ||
      u.mobile.includes(search);

    const matchYear = !year || u.entryyear === year;
    const matchGender = !gender || u.gender === gender;

    return matchSearch && matchYear && matchGender;
  });

  renderTable(filtered);
}

searchInput.addEventListener("input", applyFilter);
yearFilter.addEventListener("change", applyFilter);
genderFilter.addEventListener("change", applyFilter);
</script>

</body>
</html>
